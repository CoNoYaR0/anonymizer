# How to Use the CV Anonymizer & Templating Engine

This guide will walk you through setting up and running the CV Anonymizer backend application. This project is a FastAPI server designed to create professional CV templates and use them to anonymize candidate CVs.

## Table of Contents

1.  [Prerequisites](#prerequisites)
2.  [Local Setup](#local-setup)
3.  [Running the Application](#running-the-application)
4.  [Using the API](#using-the-api)
    *   [Workflow 1: Create a Template from a DOCX](#workflow-1-create-a-template-from-a-docx)
    *   [Workflow 2: Anonymize a CV with a Template](#workflow-2-anonymize-a-cv-with-a-template)

---

## Prerequisites

Before you begin, make sure you have the following installed on your system:

*   **Python** (version 3.9 or higher)
*   **pip** (Python's package installer)
*   **Poppler**: This is required for PDF processing.
    *   **On macOS (using Homebrew):** `brew install poppler`
    *   **On Debian/Ubuntu:** `sudo apt-get install poppler-utils`
*   **Tesseract**: This is required for OCR (extracting text from images).
    *   **On macOS (using Homebrew):** `brew install tesseract`
    *   **On Debian/Ubuntu:** `sudo apt-get install tesseract-ocr`

---

## Local Setup

Follow these steps to get the project running on your local machine.

### 1. Clone the Repository

```bash
git clone <repository-url>
cd cv-anonymizer-backend
```

### 2. Install Dependencies

Install the required Python libraries using `pip`:

```bash
pip install -r requirements.txt
```

### 3. Set Up Environment Variables

Create a file named `.env` in the root of the project directory and add the following lines:

```
OPENAI_API_KEY="YOUR_OPENAI_API_KEY"
CONVERTIO_API_KEY="YOUR_CONVERTIO_API_KEY"
DEBUG="False"
```

*   **`OPENAI_API_KEY`**: Your API key from [platform.openai.com](https://platform.openai.com/). This is used for structuring data from CVs and injecting Liquid placeholders.
*   **`CONVERTIO_API_KEY`**: Your API key from [convertio.co/api/](https://convertio.co/api/). This is required for the high-fidelity DOCX-to-HTML conversion.
*   **`DEBUG`**: Set to `"True"` to enable detailed debug logging.

---

## Running the Application

Once you have completed the setup, you can run the application using `uvicorn`, a fast ASGI server.

```bash
uvicorn main:app --reload
```

This command starts the server. The `--reload` flag makes the server restart automatically when you make changes to the code. The API will be available at `http://127.0.0.1:8000`.

---

## Using the API

The application provides a simple and powerful REST API. The easiest way to explore and test the endpoints is through the interactive Swagger UI documentation, which is automatically generated by FastAPI.

*   **Swagger UI URL:** `http://127.0.0.1:8000/docs`

Open this URL in your browser to see all available endpoints and test them directly.

### Workflow 1: Create a Template from a DOCX

This endpoint converts a styled `.docx` file into a reusable HTML/Liquid template.

*   **URL:** `/templates/create-from-docx`
*   **Method:** `POST`
*   **Body:** `multipart/form-data` with a `file` field containing your `.docx` CV template.

**Example using `curl`:**
```bash
curl -X POST -F "file=@/path/to/your/template.docx" http://127.0.0.1:8000/templates/create-from-docx
```

**Successful Response:**
The API will return the generated HTML/Liquid template as a downloadable HTML file. The response will have a `Content-Disposition` header to suggest a filename.

### Workflow 2: Anonymize a CV with a Template

This endpoint takes any candidate CV, extracts its content into a structured JSON object, and renders it into a final PDF using a specified template.

*   **URL:** `/cv/anonymize`
*   **Method:** `POST`
*   **Body:** `multipart/form-data` with two fields:
    1.  `cv_file`: The candidate's CV file (can be `.pdf`, `.docx`, `.png`, etc.).
    2.  `template_name`: The filename of the HTML/Liquid template to use (e.g., `professional_template.html`). This file must exist in the `templates/html/` directory.

**Example using `curl`:**
```bash
curl -X POST \
  -F "cv_file=@/path/to/candidate_cv.pdf" \
  -F "template_name=professional_template.html" \
  http://127.0.0.1:8000/cv/anonymize
```

**Successful Response:**
The API will return the final, anonymized CV as a downloadable PDF file. The response will have a `Content-Disposition` header to suggest a filename like `anonymized_candidate_cv.pdf`.
